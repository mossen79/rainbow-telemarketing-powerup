    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rainbow Telemarketing Scripts</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
    <div id="script-container">
        <div id="script-header">
            <h2 id="script-title">Skrypt Rozmowy</h2>
        </div>

        <!-- G≈Ç√≥wna czƒô≈õƒá skryptu (zmienia siƒô dynamicznie) -->
        <div id="script-content">
            <div id="script-text-box">
                <div class="label">POWIEDZ:</div>
                <div id="script-text" class="speech-box-large"></div>
            </div>

            <div id="responses-section">
                <div class="label">KLIENT ODPOWIEDZIA≈Å:</div>
                <div id="response-buttons" class="response-grid"></div>
            </div>
        </div>
        
        <!-- Sekcja notatek (STA≈ÅA, nie znika) -->
        <div id="notes-section">
            <div class="label">üìù NOTATKI:</div>
            <textarea id="notes-textarea" class="notes-textarea" placeholder="Wpisz notatki z rozmowy..."></textarea>
        </div>

        <div id="script-footer">
            <button id="back-btn" class="secondary-btn" style="display:none;">‚Üê Cofnij</button>
            <button id="copy-notes-btn" class="secondary-btn success">üìã Skopiuj notatki</button>
            <button id="close-btn" class="secondary-btn">‚úï Zamknij</button>
        </div>

        <div id="history-panel" style="display:none;">
            <div class="label">Historia rozmowy:</div>
            <div id="history-list"></div>
        </div>

        <!-- Error/Warning notifications -->
        <div id="notification" class="notification" style="display:none;"></div>
    </div>

    <script>
        var t = TrelloPowerUp.iframe();
        
        // PROSTY SKRYPT BEZ AUTOMATYZACJI
        const SCRIPT_DATA = {"name":"Odkurzacz Rainbow","steps":{"start":{"name":"Powitanie","say":"Dzie≈Ñ dobry, nazywam siƒô [TWOJE IMIƒò], dzwoniƒô z firmy Rainbow System.\n\nCzy mogƒô rozmawiaƒá z PaniƒÖ/Panem [IMIƒò Z LEADA]?","responses":[{"label":"Tak, s≈Çucham","next":"intro"},{"label":"To nie ja / Z≈Çy numer","next":"wrong_number"},{"label":"Nie mam czasu teraz","next":"callback_request"},{"label":"Nie interesuje mnie","next":"objection_start"}]},"intro":{"name":"Wprowadzenie","say":"Dzwoniƒô w sprawie darmowej prezentacji odkurzacza Rainbow System.\n\nCzy s≈Çysza≈Ça/s≈Çysza≈Ç Pani/Pan o tej marce?","responses":[{"label":"Tak, znam Rainbow","next":"pitch_short"},{"label":"Nie, nie znam","next":"pitch_full"},{"label":"Mam ju≈º Rainbow","next":"already_has"},{"label":"Nie interesuje mnie","next":"objection_1"}]},"pitch_full":{"name":"Pe≈Çna prezentacja oferty","say":"Rainbow to ameryka≈Ñski system czyszczenia z 90-letniƒÖ tradycjƒÖ. Nie jest to zwyk≈Çy odkurzacz - to profesjonalny system oczyszczania powietrza i czyszczenia ca≈Çego domu.\n\nPrezentacja jest ca≈Çkowicie darmowa, trwa oko≈Ço 45 minut i odbywa siƒô w Pa≈Ñstwa domu. Poka≈ºemy jak Rainbow czy≈õci dywany, materace, usunie kurz i roztocza.\n\nKiedy mog≈Çabym/m√≥g≈Çbym um√≥wiƒá prezentacjƒô?","responses":[{"label":"Dzisiaj / Jutro","next":"book_soon"},{"label":"W tym tygodniu","next":"book_this_week"},{"label":"W weekend","next":"book_weekend"},{"label":"Muszƒô pomy≈õleƒá","next":"objection_think"},{"label":"To za drogie","next":"objection_price"}]},"pitch_short":{"name":"Kr√≥tka prezentacja oferty","say":"≈öwietnie! To Pani/Pan wie jaka to solidna marka.\n\nOrganizujemy darmowe prezentacje w domach klient√≥w. Trwa 45 minut, poka≈ºemy wszystkie mo≈ºliwo≈õci Rainbow - czyszczenie dywan√≥w, materac√≥w, usuwanie roztoczy.\n\nKiedy mog≈Çabym/m√≥g≈Çbym um√≥wiƒá prezentacjƒô?","responses":[{"label":"Dzisiaj / Jutro","next":"book_soon"},{"label":"W tym tygodniu","next":"book_this_week"},{"label":"W weekend","next":"book_weekend"},{"label":"Muszƒô pomy≈õleƒá","next":"objection_think"}]},"book_soon":{"name":"Umawianie na najbli≈ºsze dni","say":"Doskonale! Proszƒô wybraƒá dogodny termin z kalendarza.\n\nPrezentacje prowadzimy: 10:00, 13:00, 16:00, 18:00, 19:30","responses":[{"label":"Wybierz termin","useCalendar":true,"next":"confirm_booking"}]},"book_this_week":{"name":"Umawianie w tym tygodniu","say":"≈öwietnie! Proszƒô wybraƒá dogodny termin z kalendarza.\n\nPrezentacje prowadzimy: 10:00, 13:00, 16:00, 18:00, 19:30","responses":[{"label":"Wybierz termin","useCalendar":true,"next":"confirm_booking"}]},"book_weekend":{"name":"Umawianie na weekend","say":"Rozumiem, weekend to dobry czas. Proszƒô wybraƒá dogodny termin z kalendarza.\n\nPrezentacje w weekendy: Sobota (10:00, 13:00, 16:00), Niedziela (11:00, 14:00, 17:00)","responses":[{"label":"Wybierz termin","useCalendar":true,"next":"confirm_booking"}]},"custom_time":{"name":"Niestandardowy termin","say":"Oczywi≈õcie, dostosujemy siƒô do Pa≈Ñstwa.\n\nProszƒô podaƒá preferowany dzie≈Ñ i godzinƒô, a ja sprawdzƒô dostƒôpno≈õƒá prezentera.","responses":[{"label":"Klient poda≈Ç termin - zapisz","next":"confirm_booking"},{"label":"Nie mo≈ºe ustaliƒá teraz","next":"callback_request"}]},"confirm_booking":{"name":"Potwierdzenie rezerwacji","say":"Doskonale! Rezerwujƒô termin prezentacji Rainbow.\n\nProszƒô potwierdziƒá dane kontaktowe:\n‚Ä¢ Numer telefonu: [NUMER Z LEADA]\n‚Ä¢ Adres: [ZAPYTAJ O ADRES]\n\nPrze≈õlƒô Pani/Panu SMS z potwierdzeniem i numerem do prezentera.\n\nDo zobaczenia!","responses":[{"label":"‚úÖ UM√ìWIONO","next":null}]},"objection_start":{"name":"Obiekcja na starcie","say":"Rozumiem. Czy mogƒô zapytaƒá co konkretnie Pani/Pana nie interesuje - prezentacja czy sam odkurzacz?","responses":[{"label":"Odkurzacz (za drogi)","next":"objection_price"},{"label":"Nie mam czasu","next":"objection_time"},{"label":"Nic mnie nie interesuje","next":"end_not_interested"}]},"objection_1":{"name":"Obiekcja po intro","say":"Rozumiem Pani/Pana wƒÖtpliwo≈õci. Ale to nie jest spotkanie sprzeda≈ºowe - to darmowa prezentacja.\n\nWiele os√≥b po prezentacji jest zaskoczonych mo≈ºliwo≈õciami Rainbow. Nie traci Pani/Pan nic, pokazujemy tylko jak dzia≈Ça.\n\nCzy mogƒô um√≥wiƒá prezentacjƒô?","responses":[{"label":"OK, um√≥w","next":"book_this_week"},{"label":"Dalej nie","next":"objection_final"}]},"objection_think":{"name":"Muszƒô pomy≈õleƒá","say":"Oczywi≈õcie, rozumiem. To wa≈ºna decyzja.\n\nCzy mogƒô oddzwoniƒá jutro lub pojutrze i um√≥wiƒá prezentacjƒô? To nic nie kosztuje, a zobaczy Pani/Pan Rainbow na ≈ºywo.","responses":[{"label":"Tak, proszƒô oddzwoniƒá","next":"callback_scheduled"},{"label":"Nie, dziƒôkujƒô","next":"end_not_interested"}]},"objection_price":{"name":"Obiekcja cenowa","say":"Rozumiem obawy o cenƒô. Ale prawda jest taka, ≈ºe Rainbow to inwestycja na 20-30 lat.\n\nOfferujemy te≈º raty 0% i programy leasingowe. Prezentacja jest za darmo - warto zobaczyƒá co dostaje siƒô za tƒô cenƒô.\n\nCzy mogƒô um√≥wiƒá prezentacjƒô?","responses":[{"label":"OK, um√≥w prezentacjƒô","next":"book_this_week"},{"label":"To i tak za drogo","next":"end_not_interested"}]},"objection_time":{"name":"Brak czasu","say":"Rozumiem, ka≈ºdy ma teraz ma≈Ço czasu.\n\nPrezentacja trwa tylko 45 minut i dostosujemy siƒô do Pa≈Ñstwa - mo≈ºemy przyjechaƒá wieczorem, w weekend, kiedy Pani/Panu pasuje.\n\nJaki termin by≈Çby najwygodniejszy?","responses":[{"label":"OK, um√≥w na weekend","next":"book_weekend"},{"label":"Dalej nie mam czasu","next":"callback_request"}]},"objection_final":{"name":"Ostatnia pr√≥ba","say":"Rozumiem. Mo≈ºe po prostu zostawiƒô sw√≥j numer - gdyby zmieni≈Ça/zmieni≈Ç Pani/Pan zdanie, proszƒô zadzwoniƒá.\n\nNumer: 123-456-789\n\nDziƒôkujƒô za rozmowƒô!","responses":[{"label":"‚ùå NIE ZAINTERESOWANY - Zapisz","next":null}]},"already_has":{"name":"Ma ju≈º Rainbow","say":"Wspaniale! To znaczy ≈ºe zna Pani/Pan jako≈õƒá Rainbow.\n\nCzy wie Pani/Pan ≈ºe mamy teraz program wymiany starszych modeli na nowe z rabatem? Nowe modele majƒÖ dodatkowe funkcje.\n\nCzy mogƒô um√≥wiƒá prezentacjƒô nowego modelu?","responses":[{"label":"Tak, interesuje mnie","next":"book_this_week"},{"label":"Nie, m√≥j dzia≈Ça OK","next":"end_has_rainbow"}]},"wrong_number":{"name":"Z≈Çy numer","say":"Rozumiem, przepraszam za pomy≈Çkƒô.\n\nMi≈Çego dnia!","responses":[{"label":"‚ùå Z≈ÅY NUMER - Zapisz","next":null}]},"callback_request":{"name":"Pro≈õba o telefon zwrotny","say":"Oczywi≈õcie, rozumiem.\n\nKiedy mogƒô oddzwoniƒá? Jutro, pojutrze?","responses":[{"label":"Jutro (podaj godzinƒô)","next":"callback_scheduled"},{"label":"Za kilka dni","next":"callback_scheduled"},{"label":"Ja sam/sama zadzwoniƒô","next":"end_callback_client"}]},"callback_scheduled":{"name":"Potwierdzenie oddzwonienia","say":"Super! Zapisujƒô i oddzwoniƒô w ustalonym terminie.\n\nDziƒôkujƒô, do us≈Çyszenia!","responses":[{"label":"‚è∞ ODDZWONIƒÜ - Zapisz w Trello","next":null}]},"end_not_interested":{"name":"Koniec - nie zainteresowany","say":"Rozumiem. Dziƒôkujƒô za po≈õwiƒôcony czas.\n\nMi≈Çego dnia!","responses":[{"label":"‚ùå NIE ZAINTERESOWANY - Zapisz","next":null}]},"end_has_rainbow":{"name":"Koniec - ma Rainbow","say":"Cieszƒô siƒô ≈ºe Rainbow Pa≈Ñstwu s≈Çu≈ºy!\n\nGdyby w przysz≈Ço≈õci potrzebowali Pa≈Ñstwo serwisu lub akcesori√≥w - proszƒô dzwoniƒá.\n\nMi≈Çego dnia!","responses":[{"label":"‚úÖ MA JU≈ª RAINBOW - Zapisz","next":null}]},"end_callback_client":{"name":"Koniec - klient oddzwoni","say":"Oczywi≈õcie! M√≥j numer: 123-456-789\n\nCzekam na telefon. Mi≈Çego dnia!","responses":[{"label":"üìû KLIENT ODDZWONI - Zapisz","next":null}]}}};

        class ScriptEngine {
            constructor(scriptData) {
                this.scriptData = scriptData;
                this.currentStep = 'start';
                this.history = [];
            }

            getCurrentStep() {
                if (!this.scriptData || !this.scriptData.steps[this.currentStep]) {
                    return null;
                }
                return this.scriptData.steps[this.currentStep];
            }

            selectResponse(responseIndex) {
                const currentStep = this.getCurrentStep();
                if (!currentStep || !currentStep.responses[responseIndex]) {
                    return false;
                }

                const response = currentStep.responses[responseIndex];

                this.history.push({
                    step: this.currentStep,
                    stepName: currentStep.name || this.currentStep,
                    said: currentStep.say,
                    response: response.label
                });

                if (response.next === null) {
                    return { end: true, outcome: response.label };
                } else {
                    this.currentStep = response.next;
                    return { end: false };
                }
            }

            goBack() {
                if (this.history.length === 0) {
                    return false;
                }

                this.history.pop();

                if (this.history.length > 0) {
                    const lastHistory = this.history[this.history.length - 1];
                    const lastStep = this.scriptData.steps[lastHistory.step];
                    const lastResponse = lastStep.responses.find(r => r.label === lastHistory.response);
                    this.currentStep = lastResponse.next;
                } else {
                    this.currentStep = 'start';
                }

                return true;
            }

            getHistory() {
                return this.history;
            }
        }

        class ScriptUI {
            constructor(engine) {
                this.engine = engine;
                this.initElements();
                this.attachEventListeners();
                this.render();
            }

            initElements() {
                this.scriptText = document.getElementById('script-text');
                this.responseButtons = document.getElementById('response-buttons');
                this.backBtn = document.getElementById('back-btn');
                this.closeBtn = document.getElementById('close-btn');
                this.historyPanel = document.getElementById('history-panel');
                this.historyList = document.getElementById('history-list');
            }

            attachEventListeners() {
                this.backBtn.addEventListener('click', () => this.handleBack());
                this.closeBtn.addEventListener('click', () => this.handleClose());
                
                const copyBtn = document.getElementById('copy-notes-btn');
                if (copyBtn) {
                    copyBtn.addEventListener('click', () => this.handleCopyNotes());
                }
            }
            
            handleCopyNotes() {
                const notesTextarea = document.getElementById('notes-textarea');
                if (notesTextarea && notesTextarea.value.trim()) {
                    notesTextarea.select();
                    document.execCommand('copy');
                    this.showNotification('‚úì Notatki skopiowane do schowka', 'success');
                } else {
                    this.showNotification('Brak notatek do skopiowania', 'warning');
                }
            }

            render() {
                const step = this.engine.getCurrentStep();

                if (!step) {
                    this.showError('B≈ÇƒÖd: brak kroku');
                    return;
                }

                this.scriptText.textContent = step.say;
                this.responseButtons.innerHTML = '';

                step.responses.forEach((response, index) => {
                    // ZAWSZE u≈ºywamy standardowych przycisk√≥w, bez kalendarza
                    const button = document.createElement('button');
                    button.className = 'response-btn';
                    button.textContent = response.label;

                    if (response.label.includes('UM√ìWIONO') || response.label.toLowerCase().includes('um√≥wiono')) {
                        button.classList.add('success');
                    } else if (response.label.includes('NIE ZAINTERESOWANY') || response.label.includes('Z≈ÅY NUMER')) {
                        button.classList.add('danger');
                    } else if (response.label.includes('ODDZWONIƒÜ') || response.label.toLowerCase().includes('p√≥≈∫niej')) {
                        button.classList.add('warning');
                    }

                    button.addEventListener('click', () => this.handleResponse(index));
                    this.responseButtons.appendChild(button);
                });

                this.backBtn.style.display = this.engine.history.length > 0 ? 'block' : 'none';
                this.updateHistory();
            }

            handleResponse(index) {
                const result = this.engine.selectResponse(index);

                if (result.end) {
                    this.showSimpleEndScreen(result.outcome);
                } else {
                    this.render();
                }
            }
            
            showSimpleEndScreen(outcome) {
                const container = document.getElementById('script-content');
                // Czy≈õcimy tylko czƒô≈õƒá skryptowƒÖ, notatki sƒÖ poni≈ºej w osobnym divie
                container.innerHTML = `
                    <div class="end-screen">
                        <h3>‚úÖ Rozmowa zako≈Ñczona</h3>
                        <p><strong>Wynik:</strong> ${outcome}</p>
                        <p style="margin-top: 20px;">Skopiuj notatki i zamknij okno.</p>
                    </div>
                `;
                
                this.closeBtn.textContent = '‚úï Zamknij';
                this.backBtn.style.display = 'none';
            }

            handleBack() {
                const success = this.engine.goBack();
                if (success) {
                    this.render();
                }
            }

            handleClose() {
                t.closeModal();
            }

            updateHistory() {
                const history = this.engine.getHistory();

                if (history.length === 0) {
                    this.historyPanel.style.display = 'none';
                    return;
                }

                this.historyPanel.style.display = 'block';
                this.historyList.innerHTML = '';

                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.textContent = `${index + 1}. ${item.stepName || 'Krok'} -> ${item.response}`;
                    this.historyList.appendChild(historyItem);
                });
            }

            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification notification-${type}`;
                notification.style.display = 'block';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 5000);
            }

            showError(message) {
                const container = document.getElementById('script-content');
                container.innerHTML = `
                    <div class="end-screen">
                        <h3>B≈ÇƒÖd</h3>
                        <p>${message}</p>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const scriptEngine = new ScriptEngine(SCRIPT_DATA);
            const scriptUI = new ScriptUI(scriptEngine);
        });
    </script>
</body>
</html>
