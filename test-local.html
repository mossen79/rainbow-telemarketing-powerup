<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rainbow Telemarketing Scripts - TEST</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            padding: 20px;
            line-height: 1.6;
        }

        #script-container {
            max-width: 600px;
            margin: 0 auto;
        }

        #script-header {
            margin-bottom: 30px;
            text-align: center;
        }

        #script-title {
            font-size: 24px;
            color: #172b4d;
            margin-bottom: 15px;
        }

        .label {
            font-size: 14px;
            font-weight: 600;
            color: #5e6c84;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #script-text-box {
            margin-bottom: 30px;
        }

        .speech-box {
            background: #f4f5f7;
            border-left: 4px solid #0079bf;
            padding: 20px;
            border-radius: 8px;
            font-size: 18px;
            line-height: 1.8;
            color: #172b4d;
            white-space: pre-wrap;
        }

        #responses-section {
            margin-bottom: 30px;
        }

        #response-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .response-btn {
            padding: 18px 24px;
            font-size: 17px;
            font-weight: 600;
            color: white;
            background: #0079bf;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .response-btn:hover {
            background: #026aa7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 121, 191, 0.3);
        }

        .response-btn:active {
            transform: translateY(0);
        }

        .response-btn.success {
            background: #61bd4f;
        }

        .response-btn.success:hover {
            background: #519839;
        }

        .response-btn.warning {
            background: #f2d600;
            color: #172b4d;
        }

        .response-btn.warning:hover {
            background: #e6c200;
        }

        .response-btn.danger {
            background: #eb5a46;
        }

        .response-btn.danger:hover {
            background: #cf513d;
        }

        #script-footer {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f4f5f7;
        }

        .secondary-btn {
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 500;
            color: #5e6c84;
            background: #f4f5f7;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .secondary-btn:hover {
            background: #e4e6ea;
            color: #172b4d;
        }

        #history-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f9fafc;
            border-radius: 8px;
        }

        #history-list {
            margin-top: 10px;
        }

        .history-item {
            padding: 8px 12px;
            margin-bottom: 6px;
            background: white;
            border-left: 3px solid #0079bf;
            border-radius: 4px;
            font-size: 14px;
            color: #5e6c84;
        }

        .end-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .end-screen h3 {
            font-size: 22px;
            color: #172b4d;
            margin-bottom: 15px;
        }

        .end-screen p {
            font-size: 16px;
            color: #5e6c84;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .response-btn {
                padding: 20px 24px;
                font-size: 18px;
            }

            .speech-box {
                font-size: 17px;
            }
        }
    </style>
</head>
<body>
    <div id="script-container">
        <div id="script-header">
            <h2 id="script-title">Skrypt Rozmowy - TEST</h2>
        </div>

        <div id="script-content">
            <div id="script-text-box">
                <div class="label">POWIEDZ:</div>
                <div id="script-text" class="speech-box"></div>
            </div>

            <div id="responses-section">
                <div class="label">KLIENT ODPOWIEDZIAŁ:</div>
                <div id="response-buttons"></div>
            </div>
        </div>

        <div id="script-footer">
            <button id="back-btn" class="secondary-btn" style="display:none;">Cofnij</button>
            <button id="close-btn" class="secondary-btn">Zamknij</button>
        </div>

        <div id="history-panel" style="display:none;">
            <div class="label">Historia rozmowy:</div>
            <div id="history-list"></div>
        </div>
    </div>

    <script>
        // Embedded script data
        const SCRIPT_DATA = {"name":"Odkurzacz Rainbow - Umówienie prezentacji","description":"Skrypt do umówienia darmowej prezentacji odkurzacza Rainbow","version":"1.0","steps":{"start":{"name":"Powitanie","say":"Dzień dobry, nazywam się [TWOJE IMIĘ], dzwonię z firmy Rainbow System.\n\nCzy mogę rozmawiać z Panią/Panem [IMIĘ Z LEADA]?","responses":[{"label":"Tak, słucham","next":"intro"},{"label":"To nie ja / Zły numer","next":"wrong_number"},{"label":"Nie mam czasu teraz","next":"callback_request"},{"label":"Nie interesuje mnie","next":"objection_start"}]},"intro":{"name":"Wprowadzenie","say":"Dzwonię w sprawie darmowej prezentacji odkurzacza Rainbow System.\n\nCzy słyszała/słyszał Pani/Pan o tej marce?","responses":[{"label":"Tak, znam Rainbow","next":"pitch_short"},{"label":"Nie, nie znam","next":"pitch_full"},{"label":"Mam już Rainbow","next":"already_has"},{"label":"Nie interesuje mnie","next":"objection_1"}]},"pitch_full":{"name":"Pełna prezentacja oferty","say":"Rainbow to amerykański system czyszczenia z 90-letnią tradycją. Nie jest to zwykły odkurzacz - to profesjonalny system oczyszczania powietrza i czyszczenia całego domu.\n\nPrezentacja jest całkowicie darmowa, trwa około 45 minut i odbywa się w Państwa domu. Pokażemy jak Rainbow czyści dywany, materace, usunie kurz i roztocza.\n\nKiedy mogłabym/mógłbym umówić prezentację?","responses":[{"label":"Dzisiaj / Jutro","next":"book_soon"},{"label":"W tym tygodniu","next":"book_this_week"},{"label":"W weekend","next":"book_weekend"},{"label":"Muszę pomyśleć","next":"objection_think"},{"label":"To za drogie","next":"objection_price"}]},"pitch_short":{"name":"Krótka prezentacja oferty","say":"Świetnie! To Pani/Pan wie jaka to solidna marka.\n\nOrganizujemy darmowe prezentacje w domach klientów. Trwa 45 minut, pokażemy wszystkie możliwości Rainbow - czyszczenie dywanów, materaców, usuwanie roztoczy.\n\nKiedy mogłabym/mógłbym umówić prezentację?","responses":[{"label":"Dzisiaj / Jutro","next":"book_soon"},{"label":"W tym tygodniu","next":"book_this_week"},{"label":"W weekend","next":"book_weekend"},{"label":"Muszę pomyśleć","next":"objection_think"}]},"book_soon":{"name":"Umawianie na najbliższe dni","say":"Doskonale! Mam wolne terminy:\n\n• Dzisiaj wieczorem o 18:00 lub 19:30\n• Jutro rano o 10:00 lub po południu o 16:00\n\nKtóry termin Pani/Panu odpowiada?","responses":[{"label":"Dzisiaj 18:00","next":"confirm_booking"},{"label":"Dzisiaj 19:30","next":"confirm_booking"},{"label":"Jutro 10:00","next":"confirm_booking"},{"label":"Jutro 16:00","next":"confirm_booking"},{"label":"Inna godzina","next":"custom_time"}]},"book_this_week":{"name":"Umawianie w tym tygodniu","say":"Świetnie! W tym tygodniu mam dostępne terminy od wtorku do piątku.\n\nKtóry dzień i pora dnia byłyby dla Pani/Pana najwygodniejsze?\n\n(Prezentacje prowadzimy: 10:00, 13:00, 16:00, 18:00, 19:30)","responses":[{"label":"Wtorek / Środa","next":"confirm_booking"},{"label":"Czwartek / Piątek","next":"confirm_booking"},{"label":"Wolę weekend","next":"book_weekend"}]},"book_weekend":{"name":"Umawianie na weekend","say":"Rozumiem, weekend to dobry czas. Mam dostępne terminy:\n\n• Sobota: 10:00, 13:00, 16:00\n• Niedziela: 11:00, 14:00, 17:00\n\nKtóry termin Pani/Panu odpowiada?","responses":[{"label":"Sobota rano/południe","next":"confirm_booking"},{"label":"Sobota popołudnie","next":"confirm_booking"},{"label":"Niedziela","next":"confirm_booking"}]},"custom_time":{"name":"Niestandardowy termin","say":"Oczywiście, dostosujemy się do Państwa.\n\nProszę podać preferowany dzień i godzinę, a ja sprawdzę dostępność prezentera.","responses":[{"label":"Klient podał termin - zapisz","next":"confirm_booking"},{"label":"Nie może ustalić teraz","next":"callback_request"}]},"confirm_booking":{"name":"Potwierdzenie rezerwacji","say":"Doskonale! Rezerwuję termin prezentacji Rainbow.\n\nProszę potwierdzić dane kontaktowe:\n• Numer telefonu: [NUMER Z LEADA]\n• Adres: [ZAPYTAJ O ADRES]\n\nPrześlę Pani/Panu SMS z potwierdzeniem i numerem do prezentera.\n\nDo zobaczenia!","responses":[{"label":"UMÓWIONO - Zapisz w Trello","next":null}]},"objection_start":{"name":"Obiekcja na starcie","say":"Rozumiem. Czy mogę zapytać co konkretnie Pani/Pana nie interesuje - prezentacja czy sam odkurzacz?","responses":[{"label":"Odkurzacz (za drogi)","next":"objection_price"},{"label":"Nie mam czasu","next":"objection_time"},{"label":"Nic mnie nie interesuje","next":"end_not_interested"}]},"objection_1":{"name":"Obiekcja po intro","say":"Rozumiem Pani/Pana wątpliwości. Ale to nie jest spotkanie sprzedażowe - to darmowa prezentacja.\n\nWiele osób po prezentacji jest zaskoczonych możliwościami Rainbow. Nie traci Pani/Pan nic, pokazujemy tylko jak działa.\n\nCzy mogę umówić prezentację?","responses":[{"label":"OK, umów","next":"book_this_week"},{"label":"Dalej nie","next":"objection_final"}]},"objection_think":{"name":"Muszę pomyśleć","say":"Oczywiście, rozumiem. To ważna decyzja.\n\nCzy mogę oddzwonić jutro lub pojutrze i umówić prezentację? To nic nie kosztuje, a zobaczy Pani/Pan Rainbow na żywo.","responses":[{"label":"Tak, proszę oddzwonić","next":"callback_scheduled"},{"label":"Nie, dziękuję","next":"end_not_interested"}]},"objection_price":{"name":"Obiekcja cenowa","say":"Rozumiem obawy o cenę. Ale prawda jest taka, że Rainbow to inwestycja na 20-30 lat.\n\nOfferujemy też raty 0% i programy leasingowe. Prezentacja jest za darmo - warto zobaczyć co dostaje się za tę cenę.\n\nCzy mogę umówić prezentację?","responses":[{"label":"OK, umów prezentację","next":"book_this_week"},{"label":"To i tak za drogo","next":"end_not_interested"}]},"objection_time":{"name":"Brak czasu","say":"Rozumiem, każdy ma teraz mało czasu.\n\nPrezentacja trwa tylko 45 minut i dostosujemy się do Państwa - możemy przyjechać wieczorem, w weekend, kiedy Pani/Panu pasuje.\n\nJaki termin byłby najwygodniejszy?","responses":[{"label":"OK, umów na weekend","next":"book_weekend"},{"label":"Dalej nie mam czasu","next":"callback_request"}]},"objection_final":{"name":"Ostatnia próba","say":"Rozumiem. Może po prostu zostawię swój numer - gdyby zmieniła/zmienił Pani/Pan zdanie, proszę zadzwonić.\n\nNumer: 123-456-789\n\nDziękuję za rozmowę!","responses":[{"label":"NIE ZAINTERESOWANY - Zapisz","next":null}]},"already_has":{"name":"Ma już Rainbow","say":"Wspaniale! To znaczy że zna Pani/Pan jakość Rainbow.\n\nCzy wie Pani/Pan że mamy teraz program wymiany starszych modeli na nowe z rabatem? Nowe modele mają dodatkowe funkcje.\n\nCzy mogę umówić prezentację nowego modelu?","responses":[{"label":"Tak, interesuje mnie","next":"book_this_week"},{"label":"Nie, mój działa OK","next":"end_has_rainbow"}]},"wrong_number":{"name":"Zły numer","say":"Rozumiem, przepraszam za pomyłkę.\n\nMiłego dnia!","responses":[{"label":"ZŁY NUMER - Zapisz","next":null}]},"callback_request":{"name":"Prośba o telefon zwrotny","say":"Oczywiście, rozumiem.\n\nKiedy mogę oddzwonić? Jutro, pojutrze?","responses":[{"label":"Jutro (podaj godzinę)","next":"callback_scheduled"},{"label":"Za kilka dni","next":"callback_scheduled"},{"label":"Ja sam/sama zadzwonię","next":"end_callback_client"}]},"callback_scheduled":{"name":"Potwierdzenie oddzwonienia","say":"Super! Zapisuję i oddzwonię w ustalonym terminie.\n\nDziękuję, do usłyszenia!","responses":[{"label":"ODDZWONIĆ - Zapisz w Trello","next":null}]},"end_not_interested":{"name":"Koniec - nie zainteresowany","say":"Rozumiem. Dziękuję za poświęcony czas.\n\nMiłego dnia!","responses":[{"label":"NIE ZAINTERESOWANY - Zapisz","next":null}]},"end_has_rainbow":{"name":"Koniec - ma Rainbow","say":"Cieszę się że Rainbow Państwu służy!\n\nGdyby w przyszłości potrzebowali Państwo serwisu lub akcesoriów - proszę dzwonić.\n\nMiłego dnia!","responses":[{"label":"MA JUŻ RAINBOW - Zapisz","next":null}]},"end_callback_client":{"name":"Koniec - klient oddzwoni","say":"Oczywiście! Mój numer: 123-456-789\n\nCzekam na telefon. Miłego dnia!","responses":[{"label":"KLIENT ODDZWONI - Zapisz","next":null}]}}};

        // Script Engine
        class ScriptEngine {
            constructor(scriptData) {
                this.scriptData = scriptData;
                this.currentStep = 'start';
                this.history = [];
            }

            getCurrentStep() {
                if (!this.scriptData || !this.scriptData.steps[this.currentStep]) {
                    return null;
                }
                return this.scriptData.steps[this.currentStep];
            }

            selectResponse(responseIndex) {
                const currentStep = this.getCurrentStep();
                if (!currentStep || !currentStep.responses[responseIndex]) {
                    return false;
                }

                const response = currentStep.responses[responseIndex];

                this.history.push({
                    step: this.currentStep,
                    stepName: currentStep.name || this.currentStep,
                    said: currentStep.say,
                    response: response.label
                });

                if (response.next === null) {
                    return { end: true, outcome: response.label };
                } else {
                    this.currentStep = response.next;
                    return { end: false };
                }
            }

            goBack() {
                if (this.history.length === 0) {
                    return false;
                }

                this.history.pop();

                if (this.history.length > 0) {
                    const lastHistory = this.history[this.history.length - 1];
                    const lastStep = this.scriptData.steps[lastHistory.step];
                    const lastResponse = lastStep.responses.find(r => r.label === lastHistory.response);
                    this.currentStep = lastResponse.next;
                } else {
                    this.currentStep = 'start';
                }

                return true;
            }

            getHistory() {
                return this.history;
            }
        }

        // UI Controller
        class ScriptUI {
            constructor(engine) {
                this.engine = engine;
                this.initElements();
                this.attachEventListeners();
                this.render();
            }

            initElements() {
                this.scriptText = document.getElementById('script-text');
                this.responseButtons = document.getElementById('response-buttons');
                this.backBtn = document.getElementById('back-btn');
                this.closeBtn = document.getElementById('close-btn');
                this.historyPanel = document.getElementById('history-panel');
                this.historyList = document.getElementById('history-list');
            }

            attachEventListeners() {
                this.backBtn.addEventListener('click', () => this.handleBack());
                this.closeBtn.addEventListener('click', () => this.handleClose());
            }

            render() {
                const step = this.engine.getCurrentStep();

                if (!step) {
                    this.showError('Błąd: brak kroku');
                    return;
                }

                this.scriptText.textContent = step.say;
                this.responseButtons.innerHTML = '';

                step.responses.forEach((response, index) => {
                    const button = document.createElement('button');
                    button.className = 'response-btn';
                    button.textContent = response.label;

                    if (response.label.includes('UMÓWIONO') || response.label.toLowerCase().includes('umówiono')) {
                        button.classList.add('success');
                    } else if (response.label.includes('NIE ZAINTERESOWANY') || response.label.includes('ZŁY NUMER')) {
                        button.classList.add('danger');
                    } else if (response.label.includes('ODDZWONIĆ') || response.label.toLowerCase().includes('później')) {
                        button.classList.add('warning');
                    }

                    button.addEventListener('click', () => this.handleResponse(index));
                    this.responseButtons.appendChild(button);
                });

                this.backBtn.style.display = this.engine.history.length > 0 ? 'block' : 'none';
                this.updateHistory();
            }

            handleResponse(index) {
                const result = this.engine.selectResponse(index);

                if (result.end) {
                    this.showEndScreen(result.outcome);
                } else {
                    this.render();
                }
            }

            handleBack() {
                const success = this.engine.goBack();
                if (success) {
                    this.render();
                }
            }

            handleClose() {
                if (confirm('Czy chcesz zamknąć okno testowe?')) {
                    window.close();
                }
            }

            updateHistory() {
                const history = this.engine.getHistory();

                if (history.length === 0) {
                    this.historyPanel.style.display = 'none';
                    return;
                }

                this.historyPanel.style.display = 'block';
                this.historyList.innerHTML = '';

                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.textContent = `${index + 1}. ${item.stepName || 'Krok'} → ${item.response}`;
                    this.historyList.appendChild(historyItem);
                });
            }

            showEndScreen(outcome) {
                const container = document.getElementById('script-content');
                container.innerHTML = `
                    <div class="end-screen">
                        <h3>Rozmowa zakończona</h3>
                        <p><strong>Wynik:</strong> ${outcome}</p>
                        <p>Możesz teraz zaktualizować kartę w Trello i zamknąć to okno.</p>
                    </div>
                `;

                this.closeBtn.textContent = 'Zamknij i wróć do Trello';
                this.backBtn.style.display = 'none';
            }

            showError(message) {
                const container = document.getElementById('script-content');
                container.innerHTML = `
                    <div class="end-screen">
                        <h3>Błąd</h3>
                        <p>${message}</p>
                    </div>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const scriptEngine = new ScriptEngine(SCRIPT_DATA);
            const scriptUI = new ScriptUI(scriptEngine);
        });
    </script>
</body>
</html>
